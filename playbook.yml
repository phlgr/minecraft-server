---
- name: Deploy Purpur Minecraft Server
  hosts: minecraft_servers
  become: true
  gather_facts: false

  pre_tasks:
    - name: Install Python3
      raw: apt-get update -qq && apt-get install -y -qq python3 python3-six
      become: true
      changed_when: false

    - name: Gather facts
      setup:

    - name: Validate OS
      fail:
        msg: "This playbook requires Ubuntu or Debian. Found: {{ ansible_distribution }}"
      when: ansible_distribution not in ['Ubuntu', 'Debian']

  roles:
    - minecraft_server

  post_tasks:
    - name: Wait for server to be ready
      wait_for:
        port: "{{ minecraft_port | default(25565) }}"
        delay: 10
        timeout: 60
